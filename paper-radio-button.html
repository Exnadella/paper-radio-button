<!--
Copyright 2013 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->

<!--
/**
 * @module Quantum Paper Elements
 */
/**
 * paper-radio-button
 *
 * Example:
 *
 *    <paper-radio-button></paper-radio-button>
 *
 * @class paper-radio-button
 * @author The Polymer Authors
 */
-->

<link rel="import" href="../paper-ink/paper-ink.html">

<polymer-element name="paper-radio-button" attributes="checked label toggles" role="radio" tabindex="0" aria-checked="false">
  <template>
    <link rel="stylesheet" href="paper-radio-button.css">
    
    <div id="radioContainer" class="{{ {labeled: label} | tokenList }}">
      <paper-ink id="ink" color="{{checked ? inkOnColor : inkOffColor}}" duration="{{duration}}"></paper-ink>
      <div id="offRadio"></div>
      <div id="onRadio" on-transitionend="{{onRadioTransitionEnd}}" on-webkittransitionend="{{onRadioTransitionEnd}}"></div>
    </div>
    <div id="radioLabel" aria-hidden="true" hidden?="{{!label}}">{{label}}<content></content></div>
    
  </template>
  <script>
    Polymer('paper-radio-button', {
      checked: false,
      toggles: false,
      inkOnColor: '#d2eff5',
      inkOffColor: '#d0d0d0',
      duration: 280,
      eventDelegates: {
        tap: 'tap',
        pointerdown: 'pointerDown',
        pointerleave: 'pointerLeave'
      },
      pointerDown: function() {
        this.$.ink.spill();
      },
      tap: function() {
        this.waitForSpillCompleted(function() {
          this.$.ink.evaporate();
          this.toggle();
          Platform.flush();
          this.fire('paper-radio-button-activate');
        });
      },
      pointerLeave: function() {
        this.waitForSpillCompleted('resetInk');
      },
      waitForSpillCompleted: function(callback) {
        this.async(callback, null, 
          (this.$.ink.spillCompleted ? 0 : this.duration));
      },
      resetInk: function() {
        this.$.ink.reset();
      },
      toggle: function() {
        this.checked = !this.toggles || !this.checked;
      },
      checkedChanged: function() {
        if (this.checked) {
          this.$.onRadio.classList.add('fill');
        } else {
          this.$.offRadio.classList.remove('hidden');
          this.$.onRadio.classList.remove('fill');
        }
        this.setAttribute('aria-checked', this.checked ? 'true': 'false');
      },
      onRadioTransitionEnd: function() {
        if (this.checked) {
          this.$.offRadio.classList.add('hidden');
        }
      },
      labelChanged: function() {
       this.setAttribute('aria-label', this.label);
      }
    });
  </script>
</polymer-element>
